{"ast":null,"code":"var __defProp = Object.defineProperty;\nvar __defNormalProp = (obj, key, value) => key in obj ? __defProp(obj, key, {\n  enumerable: true,\n  configurable: true,\n  writable: true,\n  value\n}) : obj[key] = value;\nvar __publicField = (obj, key, value) => {\n  __defNormalProp(obj, typeof key !== \"symbol\" ? key + \"\" : key, value);\n  return value;\n};\nimport { Vector3, Spherical, MathUtils } from \"three\";\nimport { EventDispatcher } from \"./EventDispatcher.js\";\nconst targetPosition = /* @__PURE__ */new Vector3();\nclass FirstPersonControls extends EventDispatcher {\n  constructor(object, domElement) {\n    super();\n    __publicField(this, \"object\");\n    __publicField(this, \"domElement\");\n    __publicField(this, \"enabled\", true);\n    __publicField(this, \"movementSpeed\", 1);\n    __publicField(this, \"lookSpeed\", 5e-3);\n    __publicField(this, \"lookVertical\", true);\n    __publicField(this, \"autoForward\", false);\n    __publicField(this, \"activeLook\", true);\n    __publicField(this, \"heightSpeed\", false);\n    __publicField(this, \"heightCoef\", 1);\n    __publicField(this, \"heightMin\", 0);\n    __publicField(this, \"heightMax\", 1);\n    __publicField(this, \"constrainVertical\", false);\n    __publicField(this, \"verticalMin\", 0);\n    __publicField(this, \"verticalMax\", Math.PI);\n    __publicField(this, \"mouseDragOn\", false);\n    // internals\n    __publicField(this, \"autoSpeedFactor\", 0);\n    __publicField(this, \"mouseX\", 0);\n    __publicField(this, \"mouseY\", 0);\n    __publicField(this, \"moveForward\", false);\n    __publicField(this, \"moveBackward\", false);\n    __publicField(this, \"moveLeft\", false);\n    __publicField(this, \"moveRight\", false);\n    __publicField(this, \"moveUp\", false);\n    __publicField(this, \"moveDown\", false);\n    __publicField(this, \"viewHalfX\", 0);\n    __publicField(this, \"viewHalfY\", 0);\n    __publicField(this, \"lat\", 0);\n    __publicField(this, \"lon\", 0);\n    __publicField(this, \"lookDirection\", new Vector3());\n    __publicField(this, \"spherical\", new Spherical());\n    __publicField(this, \"target\", new Vector3());\n    __publicField(this, \"connect\", domElement => {\n      domElement.setAttribute(\"tabindex\", \"-1\");\n      domElement.style.touchAction = \"none\";\n      domElement.addEventListener(\"contextmenu\", this.contextmenu);\n      domElement.addEventListener(\"mousemove\", this.onMouseMove);\n      domElement.addEventListener(\"mousedown\", this.onMouseDown);\n      domElement.addEventListener(\"mouseup\", this.onMouseUp);\n      this.domElement = domElement;\n      window.addEventListener(\"keydown\", this.onKeyDown);\n      window.addEventListener(\"keyup\", this.onKeyUp);\n      this.handleResize();\n    });\n    __publicField(this, \"dispose\", () => {\n      var _a, _b, _c, _d;\n      (_a = this.domElement) == null ? void 0 : _a.removeEventListener(\"contextmenu\", this.contextmenu);\n      (_b = this.domElement) == null ? void 0 : _b.removeEventListener(\"mousedown\", this.onMouseDown);\n      (_c = this.domElement) == null ? void 0 : _c.removeEventListener(\"mousemove\", this.onMouseMove);\n      (_d = this.domElement) == null ? void 0 : _d.removeEventListener(\"mouseup\", this.onMouseUp);\n      window.removeEventListener(\"keydown\", this.onKeyDown);\n      window.removeEventListener(\"keyup\", this.onKeyUp);\n    });\n    __publicField(this, \"handleResize\", () => {\n      if (this.domElement) {\n        this.viewHalfX = this.domElement.offsetWidth / 2;\n        this.viewHalfY = this.domElement.offsetHeight / 2;\n      }\n    });\n    __publicField(this, \"onMouseDown\", event => {\n      var _a;\n      (_a = this.domElement) == null ? void 0 : _a.focus();\n      if (this.activeLook) {\n        switch (event.button) {\n          case 0:\n            this.moveForward = true;\n            break;\n          case 2:\n            this.moveBackward = true;\n            break;\n        }\n      }\n      this.mouseDragOn = true;\n    });\n    __publicField(this, \"onMouseUp\", event => {\n      if (this.activeLook) {\n        switch (event.button) {\n          case 0:\n            this.moveForward = false;\n            break;\n          case 2:\n            this.moveBackward = false;\n            break;\n        }\n      }\n      this.mouseDragOn = false;\n    });\n    __publicField(this, \"onMouseMove\", event => {\n      if (this.domElement) {\n        this.mouseX = event.pageX - this.domElement.offsetLeft - this.viewHalfX;\n        this.mouseY = event.pageY - this.domElement.offsetTop - this.viewHalfY;\n      }\n    });\n    __publicField(this, \"onKeyDown\", event => {\n      switch (event.code) {\n        case \"ArrowUp\":\n        case \"KeyW\":\n          this.moveForward = true;\n          break;\n        case \"ArrowLeft\":\n        case \"KeyA\":\n          this.moveLeft = true;\n          break;\n        case \"ArrowDown\":\n        case \"KeyS\":\n          this.moveBackward = true;\n          break;\n        case \"ArrowRight\":\n        case \"KeyD\":\n          this.moveRight = true;\n          break;\n        case \"KeyR\":\n          this.moveUp = true;\n          break;\n        case \"KeyF\":\n          this.moveDown = true;\n          break;\n      }\n    });\n    __publicField(this, \"onKeyUp\", event => {\n      switch (event.code) {\n        case \"ArrowUp\":\n        case \"KeyW\":\n          this.moveForward = false;\n          break;\n        case \"ArrowLeft\":\n        case \"KeyA\":\n          this.moveLeft = false;\n          break;\n        case \"ArrowDown\":\n        case \"KeyS\":\n          this.moveBackward = false;\n          break;\n        case \"ArrowRight\":\n        case \"KeyD\":\n          this.moveRight = false;\n          break;\n        case \"KeyR\":\n          this.moveUp = false;\n          break;\n        case \"KeyF\":\n          this.moveDown = false;\n          break;\n      }\n    });\n    __publicField(this, \"lookAt\", (x, y, z) => {\n      if (x instanceof Vector3) {\n        this.target.copy(x);\n      } else if (y && z) {\n        this.target.set(x, y, z);\n      }\n      this.object.lookAt(this.target);\n      this.setOrientation();\n      return this;\n    });\n    __publicField(this, \"update\", delta => {\n      if (!this.enabled) return;\n      if (this.heightSpeed) {\n        const y = MathUtils.clamp(this.object.position.y, this.heightMin, this.heightMax);\n        const heightDelta = y - this.heightMin;\n        this.autoSpeedFactor = delta * (heightDelta * this.heightCoef);\n      } else {\n        this.autoSpeedFactor = 0;\n      }\n      const actualMoveSpeed = delta * this.movementSpeed;\n      if (this.moveForward || this.autoForward && !this.moveBackward) {\n        this.object.translateZ(-(actualMoveSpeed + this.autoSpeedFactor));\n      }\n      if (this.moveBackward) this.object.translateZ(actualMoveSpeed);\n      if (this.moveLeft) this.object.translateX(-actualMoveSpeed);\n      if (this.moveRight) this.object.translateX(actualMoveSpeed);\n      if (this.moveUp) this.object.translateY(actualMoveSpeed);\n      if (this.moveDown) this.object.translateY(-actualMoveSpeed);\n      let actualLookSpeed = delta * this.lookSpeed;\n      if (!this.activeLook) {\n        actualLookSpeed = 0;\n      }\n      let verticalLookRatio = 1;\n      if (this.constrainVertical) {\n        verticalLookRatio = Math.PI / (this.verticalMax - this.verticalMin);\n      }\n      this.lon -= this.mouseX * actualLookSpeed;\n      if (this.lookVertical) this.lat -= this.mouseY * actualLookSpeed * verticalLookRatio;\n      this.lat = Math.max(-85, Math.min(85, this.lat));\n      let phi = MathUtils.degToRad(90 - this.lat);\n      const theta = MathUtils.degToRad(this.lon);\n      if (this.constrainVertical) {\n        phi = MathUtils.mapLinear(phi, 0, Math.PI, this.verticalMin, this.verticalMax);\n      }\n      const position = this.object.position;\n      targetPosition.setFromSphericalCoords(1, phi, theta).add(position);\n      this.object.lookAt(targetPosition);\n    });\n    __publicField(this, \"contextmenu\", event => event.preventDefault());\n    __publicField(this, \"setOrientation\", () => {\n      this.lookDirection.set(0, 0, -1).applyQuaternion(this.object.quaternion);\n      this.spherical.setFromVector3(this.lookDirection);\n      this.lat = 90 - MathUtils.radToDeg(this.spherical.phi);\n      this.lon = MathUtils.radToDeg(this.spherical.theta);\n    });\n    this.object = object;\n    this.domElement = domElement;\n    this.setOrientation();\n    if (domElement) this.connect(domElement);\n  }\n}\nexport { FirstPersonControls };\n//# sourceMappingURL=FirstPersonControls.js.map","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}